
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.0">
    
    
      
        <title>10.- Accés a dades - PROGRAMACIÓ 1DAW</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.33e2939f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheet/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tema-10-acces-a-dades" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PROGRAMACIÓ 1DAW" class="md-header__button md-logo" aria-label="PROGRAMACIÓ 1DAW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PROGRAMACIÓ 1DAW
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              10.- Accés a dades
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PROGRAMACIÓ 1DAW" class="md-nav__button md-logo" aria-label="PROGRAMACIÓ 1DAW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    PROGRAMACIÓ 1DAW
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Index
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tema%2001.%20Introducci%C3%B3%20a%20la%20programaci%C3%B3/" class="md-nav__link">
        1.- Introducció
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tema%2002.%20Programaci%C3%B3%20Estructurada/" class="md-nav__link">
        2.- Programació Estructurada
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tema%2003.%20El%20llenguatge%20Java/" class="md-nav__link">
        3.- El llenguatge Java
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tema%2004.%20Programaci%C3%B3%20Modular/" class="md-nav__link">
        4.- Programació Modular
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tema%2005.%20Tipus%20compostos%20de%20dades/" class="md-nav__link">
        5.- Tipus Compostos de dades
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tema%2006.%20Programaci%C3%B3%20Orientada%20a%20Objectes/" class="md-nav__link">
        6.- Programació Orientada a Objectes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tema%2007.%20Her%C3%A8ncia%2C%20polimorfisme%20i%20interf%C3%ADcies/" class="md-nav__link">
        7.- Herència, polimorfisme i interfícies
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tema%2008.%20Entrada%2C%20eixida%20i%20excepcions/" class="md-nav__link">
        8.- Entrada, eixida i excepcions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tema%2009.%20Gr%C3%A0fics.%20Java%20Swing/" class="md-nav__link">
        9.- Gràfics. Java Swing.
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          10.- Accés a dades
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        10.- Accés a dades
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccio" class="md-nav__link">
    Introducció
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jdbc" class="md-nav__link">
    JDBC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installacio-de-drivers" class="md-nav__link">
    Instal·lació de drivers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connexio-a-la-base-de-dades" class="md-nav__link">
    Connexió a la base de dades
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obtencio-de-dades" class="md-nav__link">
    Obtenció de dades
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="tema-10-acces-a-dades">Tema 10. Accés a dades</h1>
<h2 id="introduccio">Introducció</h2>
<p>Fins ara hem estat treballant amb aplicacions que si necessitaven desar informació o carregar-la, ho feiem utilitzant arxius o la consola d'entrada. En aquest tema veurem com podem connectar una aplicació Java a una base de dades MySql.</p>
<h2 id="jdbc">JDBC</h2>
<p>Java proporciona l’API <strong>Java Database Connectivity</strong> (connectivitat Java a bases dedades) com a mecanisme per poder generar i invocar sentències SQL sobre una base de dades relacional mitjançant codi en programes Java. La seva particularitat és que, en contrast amb altres sistemes existents, ofereix una interfície comuna per a l’accés a qualsevol tipus de BD, independentment del fabricant. Per al desenvolupador, la BD real que hi ha al darrere és totalment transparent i obvia la necessitat d’efectuar cap classe de configuració en la màquina on s’executa l’aplicació que accedeix ales dades. Aquesta biblioteca es troba principalment en els paquets <strong>java.sql</strong> i <strong>javax.sql</strong>. </p>
<p>Partint de la suposició que ja hi ha una BD correctament configurada i a la qualvolem accedir des del codi d’un programa Java, el resum de passos que cal fer dins l’aplicació és:</p>
<ol>
<li>Importar correctament els packages corresponents</li>
<li>Carregar el controlador (driver) per a l’accés a la BD. Aquest depèn de la BD a accedir.</li>
<li>Establir la connexió a la BD.</li>
<li>A partir d’aquí, ja es poden executar sentències SQL en la BD i processarles respostes.</li>
<li>Quan ja no es vol treballar més amb la BD, cal tancar la connexió.</li>
</ol>
<p>JDBC, igual que moltes altres API en Java, està dissenyat amb la simplicitat enel pensament i intenta que l’ordre de les operacions que ha de fer l’operador siga genèric i, fins a cert punt, lògic. Igual que per llegir dades d’un fitxer el que cal ferés dir quina és la seva ubicació, obrir-lo, llegir o escriure les dades i tancar-lo, enaquest cas la idea és similar. Simplement, “llegir-lo o escriure’l” vol dir invocaruna sentència SQL, enlloc de posicionar un apuntador. Tot i així, cal tenir un cert domini d’SQL per poder fer correctament aquesta feina.</p>
<h2 id="installacio-de-drivers">Instal·lació de drivers</h2>
<p>Per poder connectar-nos a una base de dades utilitzant <strong>JDBC</strong> primer hem d'instal·lar els drivers i afegir-los al classpath per tal que siguen accessibles. Cada fabricant de sistemes gestors de bases de dades ofereix el connector JDBC per a la seua base de dades, això vol dir que si la nostra aplicació s'ha de connectar a una base de dades mysql, serà des del lloc web de MySql d'on ens haruem de descarregar el driver, mentre que si el que volem és accedir a una base de dades Oracle, haurem d'obtenir el driver JDBC des d'Oracle.</p>
<h3 id="descarregar-driver">Descarregar driver</h3>
<p>A continuació podeu entrar i descarregar el driver JDBC per a MySql de de la següent pàgina:</p>
<p>https://dev.mysql.com/downloads/connector/j/</p>
<pre><code class="language-console">$&gt; apt install ./mysql-connector-java_8.0.24-1ubuntu20.04_all.deb

$&gt; dpkg -i mysql-connector-java_8.0.24-1ubuntu20.04_all.deb
</code></pre>
<p>Una vegada executades aquestos commandaments, tindrem didponible el paquest mysql-connector.jar a la ruta /usr/share/java i ara hauriem de podre afegir el paquet al classpath del nostre projecte.</p>
<h3 id="afegir-al-classpath">Afegir al Classpath</h3>
<p>Allò important és que el fitxer que conté el driver <strong>mysql-connector.jar</strong> es trobe dins del classpath del projecte. Ja que anirem a eixe path per carregar-lo i utilitzar-lo al notre programa.</p>
<p>La manera més facil d'afegir el paquet al classpath del nostre projecte és amb eclipse. Fem clic dret sobre el nostre projecte i seleccionem <strong>propietats</strong></p>
<p><img alt="Afegir JDBC Classpath" src="../assets/Tema10/Classpath1.png" /></p>
<p>Al diàleg que s'ens obre, hem d'anar a <strong>Java Build Path</strong> i dins de la pestanya <strong>Libraries</strong> punxar sobre l'opció <strong>Classpath</strong> per finalment fer clic al botó <strong>Add External JARs</strong>.</p>
<p><img alt="Afegir JDBC Classpath" src="../assets/Tema10/Classpath2.png" /></p>
<p>Ja només ens quedaria anar a la carpeta en la qual es troba el fitxer .jar del driver i seleccionar-lo.</p>
<p><img alt="Afegir JDBC Classpath" src="../assets/Tema10/Classpath3.png" /></p>
<p>Finalment premem el botó <strong>Aplicar i tancar</strong> i ja ho tindriem al path del nostre projecte.</p>
<h2 id="connexio-a-la-base-de-dades">Connexió a la base de dades</h2>
<p>Per tal de podre connectar amb una base de dades utilitzarem els paquets <strong>java.sql</strong> i <strong>javax.sql</strong>. Dins d'aquestos paquets disposem d'una sèrie de classes,interfícies etc.. que ens serviran per poder interactuar amb el nostre sistema gestor de bases de dades. Els més importants són: la classe <strong>DriveManager</strong> i les interfícies: <strong>ResultSet</strong>, <strong>Connection</strong>, <strong>Statement</strong> i <strong>DataSource</strong>. Per tant primer, importem tant <strong>java.sql</strong> com <strong>javax.sql</strong> al nostre projecte.</p>
<p>```java linenums="1"
import java.sql.<em>;
import javax.sql.</em>;</p>
<pre><code>Una vegada ja tenim importats els paquets del driver JDBC, hem d'establir la connexió a la base de dades mitjançant un objecte connexió i aquest objecte connexió estarà relacionat amb un String on s'emmagatzemarà la cadena de connexió a la base de dades. Veiem alguns exemples de cadenes de connexió:

- jdbc:mysql://localhost:port/BD
- jdbc:odbc:DSN_BD
- jdbc:oracle:usuari@servidor:port:BD

Cal tindre també l'usuari i la contrassenya d'accés a la base de dades. També esl pot donar el cas que es llence una excepció, per tant, necessitarem posar el codi dins d'un bloc try..catch.

En definitiva per tal d'establir una connexió amb la nostra base de dades en Java ho fariem de la següent forma:

```java linenums=&quot;1&quot;
import java.sql.*;
import javax.sql.*;

public class ConnectaBD {

    private Connection con;

    public MySqlConnection () {
        try {
            // 1. Establim la connexió amb la base de dades.
            con = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/CicleFormatiu&quot;, &quot;root&quot;, &quot;******&quot;);

        } catch (Exception e) {
            System.out.println(&quot;Error Accés BD&quot;);
        }
    }
}
</code></pre>
<p>I des del main o la classe Test que conté el mètode main estàtic:</p>
<p>```java linenums="1"
import java.sql.<em>;
import javax.sql.</em>;</p>
<p>public class TestBD {</p>
<div class="highlight"><pre><span></span><code>public static void main(String[] args) {
    ConnectaBD m = new ConnectaBD();
}
</code></pre></div>
<p>}</p>
<pre><code>
Arribats a aquest punt ja tindriem establerta la connexio entre la nostra aplicació i la base de dades

## Creació i execució de sentències SQL

El següent pas, una vegada ja tenim establerta la connexió amb la nostra base de dades hem de crear un objecte **Statement** des del objecte connexió amb el mètode **createStatement()** que ens retornarà un objecte de tipus **Statement**.

```java linenums=&quot;1&quot;
import java.sql.*;
import javax.sql.*;

public class ConnectaBD {

    private Connection con;
    private Statement stat;

    public ConnectaBD () {
        try {
            // 1. Establim la connexió amb la base de dades.
            con = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/CicleFormatiu&quot;, &quot;root&quot;, &quot;******&quot;);

            // 2. Creem l'objecte Statement.
            stat = con.createStatement();

        } catch (Exception e) {
            System.out.println(&quot;Error Accés BD&quot;);
        }
    }
}
</code></pre>
<p>Ara hauriem de poder executar les sentències SQL que necessitem. Per poder executar sentències Sql utilitzarem el mètode <strong>executeQuery()</strong> que és un mètode que pertany a l'objecte <strong>Statement</strong> anteriorment creat. Aquest mètode ens resornarà un <strong>ResultSet</strong> què és on tindrem la informació obtesa de la base de dades.</p>
<p>En el nostre exemple, crearem un mèotde nou a la classe <strong>MySqlConnection</strong> de tipus public al qual se li passarà un objecte strQuery de tipus String i ens retornarà un ResultSet. Veiem el codi c continuació:</p>
<p>```java linenums="1"
public ResultSet ExecutarSQL (String strQuery) {
    ResultSet rs = null;</p>
<div class="highlight"><pre><span></span><code>if ( strQuery == null )
    return null;
try {
    rs = stat.executeQuery(strQuery);
} catch (Exception e) {
    System.out.println(&quot;Error executant SQL&quot;);
}
return rs;
}
</code></pre></div>
<pre><code>
Amb aquest codi, des de la nostra classe on es troba el mètode main estatic podriem fer el següent:

```java linenums=&quot;1&quot;
import java.sql.*;
import javax.sql.*;

public class TestBD {

    public static void main(String[] args) {
        ConnectaBD m = new ConnectaBD();
        ResultSet rs = m.ExecutarSQL(&quot;SELECT * FROM Alumnes;&quot;);
    }

}
</code></pre>
<p>Una vegada executat i comprovat aquest codi, deuriem tindre tots els alumnes de la nostra base de dades al ResultSet <strong>rs</strong>.</p>
<h2 id="obtencio-de-dades">Obtenció de dades</h2>
<p>I ara com llegim els registres de la BD?</p>
<p>En el <strong>ResultSet</strong> que hem obtés al pas anterior, el que tindrem serà una espècie de taula on podrem recorrer tota la informació.  Per poder accedir a aquest resultSet podem utilitzar els mètodes <strong>getString()</strong> i <strong>next()</strong> de l'objecte <strong>resultSet</strong>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../Tema%2009.%20Gr%C3%A0fics.%20Java%20Swing/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              9.- Gràfics. Java Swing.
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.d892486b.min.js"></script>
      
    
  </body>
</html>